<div class="game-area">
    <div class="board-section">
        <div class="board-container">
            <div class="rank-labels">
                <span>8</span>
                <span>7</span>
                <span>6</span>
                <span>5</span>
                <span>4</span>
                <span>3</span>
                <span>2</span>
                <span>1</span>
            </div>
            {% include "partials/board.html" %}
            <div class="file-labels">
                <span>a</span>
                <span>b</span>
                <span>c</span>
                <span>d</span>
                <span>e</span>
                <span>f</span>
                <span>g</span>
                <span>h</span>
            </div>
        </div>
        
        {% if show_promotion %}
            {% include "partials/promotion.html" %}
        {% endif %}
        
        {% if show_save_dialog %}
            {% include "partials/save_dialog.html" %}
        {% endif %}
        
        {# Only show modal overlay if game ended during this session #}
        {% if game_result and game_ended_during_session and not show_save_dialog %}
            <div class="game-over-overlay">
                <div class="game-over-modal">
                    <h2>Game Over</h2>
                    <p class="result">
                        {% if game_result == '1-0' %}
                            White wins!
                        {% elif game_result == '0-1' %}
                            Black wins!
                        {% else %}
                            Draw!
                        {% endif %}
                    </p>
                    <p class="result-code">{{ game_result }}</p>
                    <div class="game-over-buttons">
                        <button class="btn btn-restart"
                                onclick="if(confirm('Start a new game with the same settings?')) { document.getElementById('restart-form').submit(); }">
                            Play Again
                        </button>
                        <button class="btn btn-save-quit"
                                hx-post="/api/show-save-dialog"
                                hx-vals='{"save_and_quit": "true"}'
                                hx-target="#game-container"
                                hx-swap="innerHTML">
                            Save & Quit
                        </button>
                        <form id="quit-form-gameover" action="/api/quit" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-quit">Quit</button>
                        </form>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
    
    <div class="info-section">
        <div class="status-panel">
            {# Show banner for loaded completed games #}
            {% if game_result and not game_ended_during_session %}
                <div class="game-complete-banner">
                    <p class="banner-title">Game Complete</p>
                    <p class="banner-result">
                        {% if game_result == '1-0' %}
                            White wins!
                        {% elif game_result == '0-1' %}
                            Black wins!
                        {% else %}
                            Draw!
                        {% endif %}
                        <span class="result-code">({{ game_result }})</span>
                    </p>
                </div>
            {% else %}
                <p class="turn-indicator">
                    {% if game_result %}
                        Game Over
                    {% else %}
                        {{ game.turn | title }} to move
                    {% endif %}
                </p>
            {% endif %}
            {% if game.is_check and not game_result %}
                <p class="check-warning">Check!</p>
            {% endif %}
            {% for message in status_messages %}
                <p class="status-message">{{ message }}</p>
            {% endfor %}
        </div>
        
        <div class="controls-panel">
            {% if not game_result %}
                {% if hints_allowed %}
                    <button class="btn btn-hints{% if show_hints %} active{% endif %}"
                            hx-post="/api/toggle-hints"
                            hx-target="#game-container"
                            hx-swap="innerHTML"
                            {% if not selected_square %}disabled{% endif %}>
                        {% if show_hints %}Hide Hints{% else %}Show Hints{% endif %}
                    </button>
                    {% if not selected_square %}
                        <p class="hint-tip">Select a piece to enable hints</p>
                    {% endif %}
                {% else %}
                    <p class="hint-tip">Hints disabled in Hard mode</p>
                {% endif %}
                
                <button class="btn btn-undo"
                        hx-post="/api/undo"
                        hx-target="#game-container"
                        hx-swap="innerHTML">
                    Undo
                </button>
                
                <button class="btn btn-save"
                        hx-post="/api/show-save-dialog"
                        hx-vals='{"save_and_quit": "false"}'
                        hx-target="#game-container"
                        hx-swap="innerHTML">
                    Save
                </button>
                
                <button class="btn btn-restart"
                        onclick="if(confirm('Restart the game? All progress will be lost.')) { document.getElementById('restart-form').submit(); }">
                    Restart
                </button>
                
                <button class="btn btn-save-quit"
                        hx-post="/api/show-save-dialog"
                        hx-vals='{"save_and_quit": "true"}'
                        hx-target="#game-container"
                        hx-swap="innerHTML">
                    Save & Quit
                </button>
                
                <button class="btn btn-quit"
                        onclick="if(confirm('Quit without saving?')) { document.getElementById('quit-form').submit(); }">
                    Quit
                </button>
            {% else %}
                {# Completed game controls - no undo, no save (already saved or just ended) #}
                <button class="btn btn-restart"
                        onclick="if(confirm('Start a new game with the same settings?')) { document.getElementById('restart-form').submit(); }">
                    New Game
                </button>
                
                {% if not game_ended_during_session %}
                    {# Loaded completed game - just show back to menu #}
                    <button class="btn btn-quit"
                            onclick="document.getElementById('quit-form').submit();">
                        Back to Menu
                    </button>
                {% else %}
                    {# Game just ended - show save options #}
                    <button class="btn btn-save"
                            hx-post="/api/show-save-dialog"
                            hx-vals='{"save_and_quit": "false"}'
                            hx-target="#game-container"
                            hx-swap="innerHTML">
                        Save
                    </button>
                    
                    <button class="btn btn-quit"
                            onclick="document.getElementById('quit-form').submit();">
                        Quit
                    </button>
                {% endif %}
            {% endif %}
        </div>
        
        {% include "partials/history.html" %}
        
        <div class="mode-panel">
            <p class="current-mode">Mode: {{ game_mode | title }}</p>
        </div>
    </div>
</div>

<!-- Hidden forms for actions that need POST -->
<form id="restart-form" action="/api/restart" method="POST" style="display: none;"></form>
<form id="quit-form" action="/api/quit" method="POST" style="display: none;"></form>
